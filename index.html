<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>obisims invoice gateway</title>
    <meta name="description" content="A demo of Stripe client-only Checkout" />

    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/global.css" />
    <!-- Load Stripe.js on your website. -->
    <script src="https://js.stripe.com/v3/"></script>
    <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
    <script>
    
    function getParameterByName(name, url) {
      if (!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, '\\$&');
      var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
          results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, ' '));
  }
  //?inv=thx-1138
 
// A $( document ).ready() block.
$( document ).ready(function() {
  var reff_invoiceNum = getParameterByName("inv") //?inv=thx-1138 = 'thx-1138'
var reff_priceId = getParameterByName("priceId")
var reff_price = getParameterByName("price")
var reff_clientName = getParameterByName("clientName")
//var reff_priceId = getParameterByName("priceId")


console.log('Invoice num is',reff_invoiceNum);
  $(".invoiceName").text(reff_invoiceNum.toUpperCase())
  $(".clientName").text(reff_clientName)
  
  $("#button_fullPay").attr('data-price-id',reff_priceId)// button_fullPay, button_depositPay
  if(reff_price){
    $("#button_fullPay").text('Pay $'+reff_price)
  }else{
    $("#button_fullPay").text('Pay Invoice')
  }
  
  /*$("#button_depositPay").attr('data-price-id',reff_priceId)
  $("#button_depositPay").text('Pay Deposit')*/
var price = ''
var data = ''
var data_a;
//console.log(stripe)
console.log('gettingData')

$.getJSON('https://api.stripe.com/v1/prices/price_1HSm1JEB9Gfp1i8QW0h8Iw3w', function(data) {
      data_a = data
      console.log('data_a',data_a)
       /* var text = `Date: ${data.date}<br>
                    Time: ${data.time}<br>
                    Unix time: ${data.milliseconds_since_epoch}`
        */            
        
        //$(".mypanel").html(text);
    });

  /*var price = stripe.prices.retrieve(
  reff_priceId //'price_1HSlhGEB9Gfp1i8Qe3ZofJlk'
);*/
console.log('price:',price)
console.log('data:',data)

});

    </script>
  </head>


  <body>
    <div class="sr-root">
      <div class="sr-main" style="display: flex;">
        <!--
          <header class="sr-header">
          <div class="sr-header__logo"></div>
        </header>
      -->
        <div class="sr-container">
          <section class="container">
            <h1 class="invoiceName"></h1>
            <h5 class="clientName">Bodega Underground</h5>
            <button
              id="button_fullPay"
              data-checkout-mode="payment"
            >
            <!-- data-price-id="price_1HSeabEB9Gfp1i8Q2LXEl78T" -->
              loading...<!--Pay $100.00 due-->
            </button>
            
           <!--<button
            id="button_depositPay"
              data-checkout-mode="payment"
              
            > data-price-id="price_1HSeabEB9Gfp1i8Q2LXEl78T" 
            loading...Pay $50.00 deposit
            </button>
            -->
          </section>
          
        </div>
        <div id="error-message"></div>
      </div>
    </div>
    <div class="banner">
      <span>
        This is a
        <a href="https://github.com/stripe-samples"> stripe </a> gateway for
        <a
          href="https://obisims.com"
        >
          obisims.com
        </a>
      </span>
    </div>

    <script>
      // Replace with your own publishable key: https://dashboard.stripe.com/test/apikeys
      var PUBLISHABLE_KEY = 'pk_live_518wo3qEB9Gfp1i8QifDcWocfocfuhEtZr6Bospg60FsnR37S6Lwt69I0EZ6hqsvul8POOgnNURETpwQOlVM3qdkO00WTqwMzVB'//'pk_test_518wo3qEB9Gfp1i8QucJ9mmE6GNat0hHIUoJD4oZJBfIuZwvhBYXLFaSJRMPwJTXGZvRWAjcKBqWKGbN7aS9ZKipg00SGxVEzsL'//'pk_test_Tr8olTkdFnnJVywwhNPHwnHK00HkHV4tnP';
      // Replace with the domain you want your users to be redirected back to after payment
      var DOMAIN = "https://invoice.obisims.com/"//"https://obisims.com/"; //location.href.replace(/[^/]*$/, '');


      var stripe = Stripe(PUBLISHABLE_KEY);

      // Handle any errors from Checkout
      var handleResult = function (result) {
        if (result.error) {
          var displayError = document.getElementById('error-message');
          displayError.textContent = result.error.message;
        }
      };

      document.querySelectorAll('button').forEach(function (button) {
        button.addEventListener('click', function (e) {
          var mode = e.target.dataset.checkoutMode;
          var priceId = e.target.dataset.priceId;
          var items = [{ price: priceId, quantity: 1 }];

          // Make the call to Stripe.js to redirect to the checkout page
          // with the sku or plan ID.
          stripe
            .redirectToCheckout({
              mode: mode,
              lineItems: items,
              successUrl:
                DOMAIN + 'success.html?session_id={CHECKOUT_SESSION_ID}',
              cancelUrl:
                DOMAIN + 'canceled.html?session_id={CHECKOUT_SESSION_ID}',
            })
            .then(handleResult);
        });
      });
    </script>
  </body>
</html>
